# message-api
message-api is an api for collecting messages from an audience.

Messages can be posted using a secret as authorization.
The tokens can be acquired through the /secrets endpoint.


## getting started
Install python 3.10 and poetry and docker-compose.

Run
```bash
poetry install
```
to install dependencies.

Change into the virtual environment
```bash
poetry shell
```

Setup the .env-file by copying the .env.example to .env
```bash
cp .env.example .env
```
and filling the JWT_SECRET_KEY and ADMIN_PASSWORD.

Choose a password for the admin account and generated the hashed admin password by exectuting
```bash
make generate-admin-pw
```

A JWT_SECRET_KEY can be generated by executing
```bash
openssl rand -hex 32
```

## run api
Now we are ready to go!

Run
```bash
make docker-redis
```
to start redis. This holds the messages and tokens.

Run
```bash
make run-api
```
to start the api.

## run api with docker-compose
Run
```bash
make build-base-image
make build-message-api
```
to build the base image with dependencies and build the message api container.

Run
```bash
make docker-run
```
to start the api and redis.

*Remark*: The docker-compose definition does not include an access token for redis. When deploying this api, an access token should be set for the redis instance. The api will read the environment variable ACCESS_TOKEN (or ACCESS_TOKEN directly from .env).

Run
```bash
make run-api
```
to start the api.
